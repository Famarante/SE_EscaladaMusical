<!DOCTYPE html>
<html>
<head>
    <script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
    <script>
        var stage, preload, bird, startTime, timerTxt;
        function init(){
            var audioPath = "assets/";
            var sounds = [
                {id:"Bird", src:"assets/sounds/bird_sound.mp3"},
                {src: "assets/images/bird_sprite.png", id: "bird_sprite"}
            ];
            createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]);
            createjs.Sound.alternateExtensions = ["ogg"];

            preload = new createjs.LoadQueue(false);
            preload.addEventListener("complete", handleComplete);
            preload.installPlugin(createjs.Sound);
            preload.loadManifest(sounds);
        }
        function handleComplete() {

            stage = new createjs.Stage("demoCanvas");
            stage.enableMouseOver();

            var backgroundImage = new createjs.Bitmap("assets/images/Mount-Everest.png");
            stage.addChild(backgroundImage);
            createjs.Ticker.addEventListener("tick", handleTick);

            var startBtnBg = new createjs.Shape();
            startBtnBg.name = "buttonBackground";
            startBtnBg.graphics.beginFill("red").drawRoundRect(0, 0, 150, 60, 10);

            var startBtnTxt = new createjs.Text("Jogar!", "bold 24px Arial", "#FFFFFF");
            startBtnTxt.name = "buttonText";
            startBtnTxt.textAlign = "center";
            startBtnTxt.textBaseline = "middle";
            startBtnTxt.x = 150/2;
            startBtnTxt.y = 60/2;

            var startBtn = new createjs.Container();
            startBtn.name = "startButton";
            startBtn.x = 750;
            startBtn.y = 465;
            startBtn.addChild(startBtnBg, startBtnTxt);

            stage.addChild(startBtn);

            startBtn.on("mouseover", handleMouseEvent);
            startBtn.on("mouseout", handleMouseEvent);
            startBtn.on("click", handleMouseEvent);

            var rulesBtnBg = new createjs.Shape();
            rulesBtnBg.name = "buttonBackground";
            rulesBtnBg.graphics.beginFill("red").drawRoundRect(0, 0, 150, 60, 10);

            var rulesBtnTxt = new createjs.Text("Regras", "bold 24px Arial", "#FFFFFF");
            rulesBtnTxt.name = "buttonText";
            rulesBtnTxt.textAlign = "center";
            rulesBtnTxt.textBaseline = "middle";
            rulesBtnTxt.x = 150/2;
            rulesBtnTxt.y = 60/2;

            timerTxt = new createjs.Text("Tempo: ", "bold 24px Arial", "#FFFFFF");
            timerTxt.name = "timerText";
            timerTxt.textAlign = "left";
            timerTxt.textBaseline = "middle";
            timerTxt.x = 760;
            timerTxt.y = 40;

            var rulesBtn = new createjs.Container();
            rulesBtn.name = "rulesButton";
            rulesBtn.x = 550;
            rulesBtn.y = 465;
            rulesBtn.addChild(rulesBtnBg, rulesBtnTxt);

            stage.addChild(rulesBtn);

            rulesBtn.on("mouseover", handleMouseEvent);
            rulesBtn.on("mouseout", handleMouseEvent);
            rulesBtn.on("click", handleMouseEvent);

            var spriteSheet = new createjs.SpriteSheet({
                framerate: 30,
                /*"images": ["assets/images/bird_sprite2.png"],
                 "frames": {"height": 168.667, "count": 14, "width": 153},
                 // define two animations, run (loops, 1.5x speed) and jump (returns to run):
                 "animations": {
                 "fly": [0, 14]
                 }*/
                "images": [preload.getResult("bird_sprite")],
                "frames": {"height": 314, "count": 22, "width": 240},
                // define two animations, run (loops, 1.5x speed) and jump (returns to run):
                "animations": {
                    "fly": [0, 21, "fly"]
                }
            });

            bird = new createjs.Sprite(spriteSheet, "fly");
            createjs.Ticker.on("tick", handleTick);

            stage.update();
        }

        function handleMouseEvent(evt) {
            var target = evt.target;
            switch(evt.type){
                case "mouseover":
                    if(target.name == "buttonBackground")
                        target.graphics.clear().beginFill("blue").drawRoundRect(0, 0, 150, 60, 10);
                    else{
                        var parent = target.parent;
                        var background = parent.children[0];
                        background.graphics.clear().beginFill("blue").drawRoundRect(0, 0, 150, 60, 10);
                    }
                    break;
                case "click":
                        if(target.parent.name == "startButton"){
                            firstLevel();
                        }
                        else if(target.parent.name == "rulesButton"){
                            alert("REGRAS");
                        }
                    break;
                case "mouseout":
                    if(target.name == "buttonBackground")
                        target.graphics.clear().beginFill("red").drawRoundRect(0, 0, 150, 60, 10);
                    else{
                        var parent = target.parent;
                        var background = parent.children[0];
                        background.graphics.clear().beginFill("red").drawRoundRect(0, 0, 150, 60, 10);
                    }
                    break;
                default:
                    break;
            }
            stage.update();
        }
        function handleTick(event) {
            var currentTime = (new Date()).getTime();
            var time = Math.floor((currentTime-startTime)/1000);
            if(time > 59){
                timerTxt.text = "Tempo: " + Math.floor(time/60) + "m" + time%60 + "s";
            }
            else{
                timerTxt.text = "Tempo: " + time + "s";
            }
            stage.update();
        }

        function playSound(target) {
            //Play the sound: play (src, interrupt, delay, offset, loop, volume, pan)
            var ppc = new createjs.PlayPropsConfig().set({interrupt: createjs.Sound.INTERRUPT_ANY, loop: -1, volume: 0.5})
            var instance = createjs.Sound.play(target, ppc);
            if (instance == null || instance.playState == createjs.Sound.PLAY_FAILED) {
                return;
            }
        }
        function handleLoad(event) {
        }
        function firstLevel(){
            clearStage();
            startTime = (new Date()).getTime();
            stage.addChild(timerTxt);
            playSound("Bird");
            stage.addChild(bird);
            stage.update();
        }
        function clearStage(){
            for(var i = 1; i < stage.numChildren; i++){
                console.log(stage.children[i]);
                stage.removeChildAt(i);
                stage.update();
                i--;
            }
        }
    </script>
</head>
<body onload="init();">
<div id="content">
<canvas id="demoCanvas" width="960" height="575"></canvas>
</div>
</body>
</html>
